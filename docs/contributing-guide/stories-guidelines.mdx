import { Meta } from '@storybook/addon-docs';
import { PageOutline } from '../components/PageOutline';

<Meta title="Contributing Guide/Stories Guidelines"/>

# Stories Guidelines
As you know we use [Storybook](https://storybook.js.org/) to create our documentation.
All components has their own stories used to present how to use it. All important things about stories are explained in the [Storybook Docs](https://storybook.js.org/basics/writing-stories/).
On this page you can find our guidelines for stories.

<PageOutline/>

## Basic
Stories should cover all possible use cases of the component.
* You should write stories for all modifiers e.g. [UiAlert](/docs/atoms-alert--default) has a story for default, success, warning and error.
* All slots should be covered. Stories for slots has name `With <slot-name> Slot` i.e. `With Title Slot`.
This stories should use default template from this component and bind all props from it.

```js
export const WithRemoveSlot = () => ({
  template: `<Component>
    <template #remove="{ clickHandler, attrs }">
      <UiButton
        v-bind="attrs"
        @click="clickHandler"
      >
        <UiIcon />
      </UiButton>
    </template>
  </Component>`
})
```


## Name Conflict
In some case we have to use the same name for slots and props. In that case Storybook will return only one of them.
Probably the slots has priority over props. To solve this issue we can use 'argTypes' and add prop and slot manual. e.g.

```js
argTypes: {
  // for props we use key with it name
  title: {
    table: {
      type: { summary: 'string' },
      category: 'props',
    },
    control: 'text',
  },
  // for slots we use key with 'Slot' suffix
  titleSlot: {
    name: 'title', // and rename it to name without suffix
    description: 'Use this slot to replace title template.',
    table: {
      type: { summary: 'unknown' },
      category: 'slots',
    },
  },
}
```

## Helpers
To avoid writing the same code for the same thing we can use helpers. Now we handle a few argTypes but probably we will add more helpers soon.

```js
import { modifiers } from '@sb/helpers/argTypes';

export default {
  argTypes: {
    modifiers: modifiers({options: ['component--primary', 'component--sections', ...]}),
  }
}
```
Helpers are stored in the `.storybook/helpers/argTypes` folder.

## Custom DocsBlock
Storybook support custom documentation components to the story. This components is created in React and stored in the `doc/component` folder.
This components is used for mdx files like guidelines.

### Page Outline
Autogenerated page outline from the headings in the page.
```js
import { PageOutline } from '../components/PageOutline';

<PageOutline/>
```

### Alert
Allow to add some message in highlighted form. Alert has border and background color. It can be used to show some important information.

```js
import { Alert } from '../components/Alert';

<Alert theme="[info|success|warning|error]">
 <p>Alert content.</p>
</Alert>
```

## Table Categories
By default in the documentation you will find 'PROPS', 'SLOTS', 'EVENTS'. But in Symptom-Checker UI Kit we have a few custom categories.
* STORIES CONTROLS - This category is used to group the controls that are used in the stories to mock some data e.g. content, items, etc.
* HTML ATTRIBUTES - This category is used to group the controls that are used as HTML attributes  e.g class or disabled

### Order of categories
* STORIES CONTROLS
* HTML ATTRIBUTES
* PROPS
* EVENTS
* SLOTS

## Events
Some components can emit events. We can use `Actions` addon to log this events and describe it in argTypes. e.g.

```js
import { actions } from '@storybook/addon-actions';

const events = actions({
  onFieldFocus: 'field-focus',
  onUpdateInvalid: 'update:invalid'
  onUpdateModelValue: 'update:modelValue',
}

export default {
  ...,
  argTypes: {
    'field-focus': {
      description: 'Use this event to detect when some field is focused.',
        table: {
        category: 'events',
      },
    },
  }
}

export const Component = (args) => ({
  setup() {
    return {
      ...args,
      ...events,
    }
  },
  template: `<Component
    @field-focus="onFieldFocus"
    @update:invalid="onUpdateInvalid"
  />`
})
```

To track emitted events you can go to `Canvas -> Actions` and click the elements on the story.

## Model Value
Storybook in Docs mode pass args with some custom way and disallow to pass props from Vue `setup() {}`.
It blocks to use `v-model` in the stories in Docs mode, in Canvas mode it works fine.
To solve this issue we use args with `init` prefix i.e. `initModelValue`, `initInvalid`.


```js
export default {
  ...,
  args: {
    initModelValue: '2077-11-27',
  },
  argTypes: {
    initModelValue: {
      description: 'Use this control to set initial state.',
      table: {
        category: 'stories controls',
      },
      control: 'text',
    },
  }
}
```

## Content
Some components can pass content e.g. label of button, array with values for checkboxes, etc.
This things is added to the STORIES CONTROLS and allow to change the content of the component/ group of components. e.g.

```js
export default {
  args: {
    values: [
      {},
      {},
      ...
  ],
  },
  argTypes: {
    values: {
      description: 'Use this control to set the values of checkbox group.',
      table: {
        category: 'stories controls',
      },
      control: 'array',
    },
  }
}
```
## CSS in stories
### Tailiwnd CSS
We use [Tailwind CSS](https://tailwindcss.com/) in our stories. Tailwind helps us to write less CSS and focus on the content of the story. We use it in decorators but not to add styles to Component Library components.

### Custom CSS
Sometimes we need to add custom CSS to the story. To handle that we add `<component-name>.stories.scss` file in component directory and import it in the `*.stories.js` e.g.

```js
// *.stories.js
import './*.stories.scss';

export default {
  title: '',
  component: '',
  ...
}
```
Mostly we want to display this custom CSS (scss to be more precise) in the documentation. To do that we need to use `*.mdx` file and import it in the `*.stories.js`. To use it in `*.stories.js` we need to set `docs` parameters e.g.

```js
// *.stories.js
import './*.stories.scss';
import docs from './*.mdx'

export default {
  title: '',
  component: '',
  parameters: { docs: { page: docs } },
}
```
To display SCSS in `mdx` file we use `<Code/>` DocBlock component e.g.

```mdx
import { Code } from '../../../../docs/components/Code';

<Meta />

## ComponentName
<Primary />
<ArgsTable />

## Stories
### With custom CSS
<Canvas>
  <Story id="with-custom-css"/>
</Canvas>

**Use following SCSS to get the same result**
<Code
  id="with-custom-css"
  code={ scss }
/>
```

And wrap the code in the `Code` tags to display it in `<Code>` block e.g.

```scss
//<Code id="with-custom-css">
.with-custom-css {
 // your custom CSS
}
//</Code>
```


